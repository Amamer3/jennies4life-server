openapi: 3.0.3
info:
  title: Jennies4life API
  description: |
    Backend API for Jennies4life affiliate marketing website.
    
    ## Authentication
    Admin endpoints require Firebase ID token in Authorization header:
    ```
    Authorization: Bearer <firebase_id_token>
    ```
    
    ## Base URL
    - Development: `http://localhost:3000`
    - Production: `https://jennies4life-server.onrender.com`
  version: 1.0.0
  contact:
    name: Jennies4life Support
    email: admin@jennies4life.com

servers:
  - url: http://localhost:3000
    description: Development server
  - url: https://jennies4life-server.onrender.com
    description: Production server

paths:
  /:
    get:
      summary: API Root
      description: Welcome endpoint with API information
      tags:
        - General
      responses:
        '200':
          description: API information
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/WelcomeResponse'

  /api/health:
    get:
      summary: Health Check
      description: Check API health status
      tags:
        - General
      responses:
        '200':
          description: Health status
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HealthResponse'

  /api/auth/login:
    post:
      summary: Admin Login
      description: Authenticate admin user with email and password
      tags:
        - Authentication
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LoginRequest'
      responses:
        '200':
          description: Login successful
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LoginResponse'
        '400':
          description: Validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Invalid or expired token
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '403':
          description: Forbidden - Admin privileges required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Admin user not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '503':
          description: Service unavailable
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/auth/refresh:
    post:
      summary: Refresh Token
      description: Refresh authentication token
      tags:
        - Authentication
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RefreshTokenRequest'
      responses:
        '200':
          description: Token refresh initiated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RefreshTokenResponse'
        '400':
          description: Validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/auth/verify:
    get:
      summary: Verify Authentication
      description: Verify current authentication status
      tags:
        - Authentication
      security:
        - FirebaseAuth: []
      responses:
        '200':
          description: Authentication verified
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/VerifyResponse'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/auth/logout:
    post:
      summary: Admin Logout
      description: Logout admin user
      tags:
        - Authentication
      security:
        - FirebaseAuth: []
      responses:
        '200':
          description: Logout successful
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LogoutResponse'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/auth/profile:
    get:
      summary: Get Admin Profile
      description: Get current admin user profile
      tags:
        - Authentication
      security:
        - FirebaseAuth: []
      responses:
        '200':
          description: Admin profile retrieved
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProfileResponse'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/products:
    get:
      summary: Get Published Products
      description: Retrieve all published products (public endpoint)
      tags:
        - Products (Public)
      responses:
        '200':
          description: List of published products
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProductListResponse'
        '500':
          description: Server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
    
    post:
      summary: Create Product
      description: Create a new product (admin only)
      tags:
        - Products (Admin)
      security:
        - FirebaseAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateProductRequest'
      responses:
        '201':
          description: Product created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProductResponse'
        '400':
          description: Validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '403':
          description: Forbidden - Admin access required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/products/{slug}:
    get:
      summary: Get Product by Slug
      description: Retrieve a single published product by slug (public endpoint)
      tags:
        - Products (Public)
      parameters:
        - name: slug
          in: path
          required: true
          schema:
            type: string
          description: Product slug
      responses:
        '200':
          description: Product details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProductResponse'
        '404':
          description: Product not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/products/{id}:
    put:
      summary: Update Product
      description: Update an existing product (admin only)
      tags:
        - Products (Admin)
      security:
        - FirebaseAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          description: Product ID
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateProductRequest'
      responses:
        '200':
          description: Product updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProductResponse'
        '400':
          description: Validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Product not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
    
    delete:
      summary: Delete Product
      description: Delete a product (admin only)
      tags:
        - Products (Admin)
      security:
        - FirebaseAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          description: Product ID
      responses:
        '200':
          description: Product deleted successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Product not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/posts:
    get:
      summary: Get Published Posts
      description: Retrieve all published blog posts (public endpoint)
      tags:
        - Posts (Public)
      responses:
        '200':
          description: List of published blog posts
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PostListResponse'
        '500':
          description: Server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
    
    post:
      summary: Create Blog Post
      description: Create a new blog post (admin only)
      tags:
        - Posts (Admin)
      security:
        - FirebaseAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreatePostRequest'
      responses:
        '201':
          description: Blog post created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PostResponse'
        '400':
          description: Validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/posts/{slug}:
    get:
      summary: Get Post by Slug
      description: Retrieve a single published blog post by slug (public endpoint)
      tags:
        - Posts (Public)
      parameters:
        - name: slug
          in: path
          required: true
          schema:
            type: string
          description: Post slug
      responses:
        '200':
          description: Blog post details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PostResponse'
        '404':
          description: Post not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/posts/{id}:
    put:
      summary: Update Blog Post
      description: Update an existing blog post (admin only)
      tags:
        - Posts (Admin)
      security:
        - FirebaseAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          description: Post ID
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdatePostRequest'
      responses:
        '200':
          description: Blog post updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PostResponse'
        '400':
          description: Validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Post not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
    
    delete:
      summary: Delete Blog Post
      description: Delete a blog post (admin only)
      tags:
        - Posts (Admin)
      security:
        - FirebaseAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          description: Post ID
      responses:
        '200':
          description: Blog post deleted successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Post not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/dashboard/stats:
    get:
      summary: Get Dashboard Statistics
      description: Retrieve dashboard statistics including product and post counts (admin only)
      tags:
        - Dashboard (Admin)
      security:
        - FirebaseAuth: []
      responses:
        '200':
          description: Dashboard statistics
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DashboardStatsResponse'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '403':
          description: Forbidden - Admin access required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/dashboard/products:
    get:
      summary: Get All Products (Admin)
      description: Retrieve all products including drafts (admin only)
      tags:
        - Dashboard (Admin)
      security:
        - FirebaseAuth: []
      responses:
        '200':
          description: List of all products
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProductListResponse'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '403':
          description: Forbidden - Admin access required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/dashboard/posts:
    get:
      summary: Get All Posts (Admin)
      description: Retrieve all posts including drafts (admin only)
      tags:
        - Dashboard (Admin)
      security:
        - FirebaseAuth: []
      responses:
        '200':
          description: List of all posts
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PostListResponse'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '403':
          description: Forbidden - Admin access required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

components:
  securitySchemes:
    FirebaseAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: Firebase ID token

  schemas:
    Product:
      type: object
      properties:
        id:
          type: string
          description: Product ID
        name:
          type: string
          description: Product name
        slug:
          type: string
          description: URL-friendly slug
        image:
          type: string
          format: uri
          description: Product image URL
        description:
          type: string
          description: Product description
        affiliateLink:
          type: string
          format: uri
          description: Affiliate link URL
        category:
          type: string
          description: Product category
        status:
          type: string
          enum: [draft, published]
          description: Product status
        createdAt:
          type: string
          format: date-time
          description: Creation timestamp
        updatedAt:
          type: string
          format: date-time
          description: Last update timestamp
      example:
        id: "abc123"
        name: "Amazing Product"
        slug: "amazing-product"
        image: "https://example.com/image.jpg"
        description: "This is an amazing product that you'll love!"
        affiliateLink: "https://affiliate.com/product/123"
        category: "Electronics"
        status: "published"
        createdAt: "2024-01-15T10:30:00Z"
        updatedAt: "2024-01-15T10:30:00Z"

    BlogPost:
      type: object
      properties:
        id:
          type: string
          description: Post ID
        title:
          type: string
          description: Post title
        slug:
          type: string
          description: URL-friendly slug
        content:
          type: string
          description: Post content (HTML/Markdown)
        coverImage:
          type: string
          format: uri
          description: Cover image URL
        tags:
          type: array
          items:
            type: string
          description: Post tags
        status:
          type: string
          enum: [draft, published]
          description: Post status
        createdAt:
          type: string
          format: date-time
          description: Creation timestamp
        updatedAt:
          type: string
          format: date-time
          description: Last update timestamp
      example:
        id: "def456"
        title: "How to Choose the Best Products"
        slug: "how-to-choose-best-products"
        content: "<p>Here's a comprehensive guide...</p>"
        coverImage: "https://example.com/cover.jpg"
        tags: ["guide", "products", "tips"]
        status: "published"
        createdAt: "2024-01-15T10:30:00Z"
        updatedAt: "2024-01-15T10:30:00Z"

    CreateProductRequest:
      type: object
      required:
        - name
        - image
        - description
        - affiliateLink
        - category
      properties:
        name:
          type: string
          description: Product name
        slug:
          type: string
          description: Custom slug (optional, auto-generated if not provided)
        image:
          type: string
          format: uri
          description: Product image URL
        description:
          type: string
          description: Product description
        affiliateLink:
          type: string
          format: uri
          description: Affiliate link URL
        category:
          type: string
          description: Product category
        status:
          type: string
          enum: [draft, published]
          default: draft
          description: Product status
      example:
        name: "Amazing Product"
        image: "https://example.com/image.jpg"
        description: "This is an amazing product that you'll love!"
        affiliateLink: "https://affiliate.com/product/123"
        category: "Electronics"
        status: "published"

    UpdateProductRequest:
      type: object
      properties:
        name:
          type: string
          description: Product name
        slug:
          type: string
          description: URL-friendly slug
        image:
          type: string
          format: uri
          description: Product image URL
        description:
          type: string
          description: Product description
        affiliateLink:
          type: string
          format: uri
          description: Affiliate link URL
        category:
          type: string
          description: Product category
        status:
          type: string
          enum: [draft, published]
          description: Product status
      example:
        name: "Updated Product Name"
        status: "published"

    CreatePostRequest:
      type: object
      required:
        - title
        - content
        - coverImage
      properties:
        title:
          type: string
          description: Post title
        slug:
          type: string
          description: Custom slug (optional, auto-generated if not provided)
        content:
          type: string
          description: Post content (HTML/Markdown)
        coverImage:
          type: string
          format: uri
          description: Cover image URL
        tags:
          type: array
          items:
            type: string
          description: Post tags
        status:
          type: string
          enum: [draft, published]
          default: draft
          description: Post status
      example:
        title: "How to Choose the Best Products"
        content: "<p>Here's a comprehensive guide...</p>"
        coverImage: "https://example.com/cover.jpg"
        tags: ["guide", "products", "tips"]
        status: "published"

    UpdatePostRequest:
      type: object
      properties:
        title:
          type: string
          description: Post title
        slug:
          type: string
          description: URL-friendly slug
        content:
          type: string
          description: Post content (HTML/Markdown)
        coverImage:
          type: string
          format: uri
          description: Cover image URL
        tags:
          type: array
          items:
            type: string
          description: Post tags
        status:
          type: string
          enum: [draft, published]
          description: Post status
      example:
        title: "Updated Post Title"
        status: "published"

    ProductResponse:
      type: object
      properties:
        success:
          type: boolean
          example: true
        data:
          $ref: '#/components/schemas/Product'
        message:
          type: string
          example: "Product created successfully"

    ProductListResponse:
      type: object
      properties:
        success:
          type: boolean
          example: true
        data:
          type: array
          items:
            $ref: '#/components/schemas/Product'

    PostResponse:
      type: object
      properties:
        success:
          type: boolean
          example: true
        data:
          $ref: '#/components/schemas/BlogPost'
        message:
          type: string
          example: "Blog post created successfully"

    PostListResponse:
      type: object
      properties:
        success:
          type: boolean
          example: true
        data:
          type: array
          items:
            $ref: '#/components/schemas/BlogPost'

    SuccessResponse:
      type: object
      properties:
        success:
          type: boolean
          example: true
        message:
          type: string
          example: "Operation completed successfully"

    ErrorResponse:
      type: object
      properties:
        success:
          type: boolean
          example: false
        error:
          type: string
          example: "Validation Error"
        message:
          type: string
          example: "Missing required fields: name, description"

    WelcomeResponse:
      type: object
      properties:
        success:
          type: boolean
          example: true
        message:
          type: string
          example: "Welcome to Jennies4life API"
        version:
          type: string
          example: "1.0.0"
        documentation:
          type: string
          example: "/api/docs"
        endpoints:
          type: object
          properties:
            products:
              type: string
              example: "/api/products"
            posts:
              type: string
              example: "/api/posts"
            health:
              type: string
              example: "/api/health"

    HealthResponse:
      type: object
      properties:
        success:
          type: boolean
          example: true
        message:
          type: string
          example: "Jennies4life API is running"
        timestamp:
          type: string
          format: date-time
          example: "2024-01-15T10:30:00Z"

    LoginRequest:
      type: object
      required:
        - email
        - password
      properties:
        email:
          type: string
          format: email
          description: Admin email address
        password:
          type: string
          description: Admin password
      example:
        email: "admin@jennies4life.com"
        password: "securepassword123"

    LoginResponse:
      type: object
      properties:
        success:
          type: boolean
          example: true
        message:
          type: string
          example: "Admin login successful"
        data:
          type: object
          properties:
            customToken:
              type: string
              description: Firebase custom token for authentication
              example: "eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9..."
            user:
              type: object
              properties:
                uid:
                  type: string
                  example: "UW1cv09lKUbJn819wprrKeYHYQW2"
                email:
                  type: string
                  example: "admin@jennies4life.com"
                displayName:
                  type: string
                  example: "Main Admin"
                role:
                  type: string
                  example: "admin"

    RefreshTokenRequest:
      type: object
      required:
        - refreshToken
      properties:
        refreshToken:
          type: string
          description: Firebase refresh token
      example:
        refreshToken: "firebase_refresh_token_here"

    RefreshTokenResponse:
      type: object
      properties:
        success:
          type: boolean
          example: true
        message:
          type: string
          example: "Token refreshed successfully"
        data:
          type: object
          properties:
            customToken:
              type: string
              description: New Firebase custom token
              example: "eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9..."
            user:
              type: object
              properties:
                uid:
                  type: string
                  example: "UW1cv09lKUbJn819wprrKeYHYQW2"
                email:
                  type: string
                  example: "admin@jennies4life.com"
                role:
                  type: string
                  example: "admin"

    VerifyResponse:
      type: object
      properties:
        success:
          type: boolean
          example: true
        message:
          type: string
          example: "Authentication verified"
        data:
          type: object
          properties:
            user:
              type: object
              properties:
                uid:
                  type: string
                email:
                  type: string
            authenticated:
              type: boolean
              example: true

    LogoutResponse:
      type: object
      properties:
        success:
          type: boolean
          example: true
        message:
          type: string
          example: "Logout successful. Please clear Firebase authentication on client side."
        data:
          type: object
          properties:
            loggedOut:
              type: boolean
              example: true

    ProfileResponse:
      type: object
      properties:
        success:
          type: boolean
          example: true
        message:
          type: string
          example: "Admin profile retrieved"
        data:
          type: object
          properties:
            user:
              type: object
              properties:
                uid:
                  type: string
                email:
                  type: string
            role:
              type: string
              example: "admin"
            permissions:
              type: array
              items:
                type: string
              example: ["read", "write", "delete"]

    DashboardStatsResponse:
      type: object
      properties:
        success:
          type: boolean
          example: true
        data:
          type: object
          properties:
            totalProducts:
              type: integer
              description: Total number of products
              example: 25
            publishedProducts:
              type: integer
              description: Number of published products
              example: 20
            draftProducts:
              type: integer
              description: Number of draft products
              example: 5
            totalPosts:
              type: integer
              description: Total number of blog posts
              example: 15
            publishedPosts:
              type: integer
              description: Number of published blog posts
              example: 12
            draftPosts:
              type: integer
              description: Number of draft blog posts
              example: 3
            recentProducts:
              type: array
              description: Last 5 created products
              items:
                $ref: '#/components/schemas/Product'
            recentPosts:
              type: array
              description: Last 5 created blog posts
              items:
                $ref: '#/components/schemas/BlogPost'

tags:
  - name: General
    description: General API endpoints
  - name: Authentication
    description: Admin authentication endpoints
  - name: Products (Public)
    description: Public product endpoints (no authentication required)
  - name: Products (Admin)
    description: Admin product endpoints (authentication required)
  - name: Posts (Public)
    description: Public blog post endpoints (no authentication required)
  - name: Posts (Admin)
    description: Admin blog post endpoints (authentication required)
  - name: Dashboard (Admin)
    description: Admin dashboard endpoints (authentication required)